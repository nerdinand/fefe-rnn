[l] Ich habe mir gerade den neuen Zerocopy-Modus von Linux 4.14 angeguckt, um das in libowfat und gatling zu implementieren, aber habe mich dann entschieden, es doch nicht zu tun. Hier ist die Dokumentation dazu. Money Quote:Copy avoidance is not a free lunch. As implemented, with page pinning, it replaces per byte copy cost with page accounting and completion notification overhead. As a result, MSG_ZEROCOPY is generally only effective at writes over around 10 KB.Dieser Fall kommt nicht vor. gatling sendet einen kleinen Header, unter 1KB, und dann die Datei. Die Datei ist haeufig groesser als 10 KB, aber das Senden der Datei findet nicht per write oder sendmsg statt, sondern per sendfile, und das ist bereits zero-copy.Ich koennte das fuer den Proxy-Modus implementieren, aber ehrlich gesagt sehe ich den Payoff nicht. Die Latenz kommt da nicht vom Kopieren sondern vom gzip der Daten, und dem https (im https-Modus geht zero-copy eh nicht, ausser man macht Kernel-TLS, und das unterstuetzt im Moment noch niemand). In der Praxis halte ich die Auswirkungen von diesem Code daher fuer Null. Die Entwickler davon mussten auch einen synthetischen Benchmark bemuehen, um einen Vorteil nachweisen zu koennen.Ich ignoriere das jetzt mal, bis mir jemand zeigt, dass das was bringt.
